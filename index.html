Â·<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë²•ë¥  ì§€ëŠ¥ì„ ìœ„í•œ ì‹ ê²½-ìƒì§• ì•„í‚¤í…ì²˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The application is structured as an interactive dashboard rather than a linear report. The core navigation is centered around a visual diagram of the two-phase process (KG Creation -> RAG Reasoning). Users can select a phase to explore its components. For Phase 1, they can browse the ontology and explore each of the 5 legal disputes through interactive cards, which reveal a summary, key issues, and a dynamically generated HTML/CSS visualization of the relevant knowledge subgraph. For Phase 2, a step-by-step wizard simulates the Graph-RAG process, from query to KG search to final, cited output. This structure was chosen to deconstruct the dense report into manageable, interactive modules, allowing users to actively explore the concepts and the case study, rather than passively reading. The goal is to make the complex architecture tangible and understandable. -->
    <!-- Visualization & Content Choices: 
        - Process Diagram: Goal is to explain the overall architecture. A custom diagram made with HTML/CSS provides a visual anchor and primary navigation, superior to a simple text list.
        - Dispute Explorer (KG Viz): Goal is to organize and show relationships in the case data. Instead of static text, interactive cards lead to a dynamically generated graph visualization for each dispute using HTML divs for nodes and JS-calculated, CSS-styled divs for edges. This directly represents the KG structure without using forbidden SVG/Mermaid libraries. Hovering on nodes provides details. This makes the data tangible.
        - RAG Simulator: Goal is to demonstrate explainable reasoning. A multi-step UI walks the user through the RAG flow. The final output includes clickable citations that highlight the corresponding evidence in a KG visualization, directly demonstrating the report's core claim of "explainability".
        - Data Tables: Goal is to inform. A standard HTML table for the "Master Ledger" provides quick, filterable reference to key entities.
        - Bar Chart: Goal is to compare. A Chart.js bar chart visualizes the monetary values of different claims, offering a quick quantitative overview.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8f7f4;
            color: #44403c;
        }
        .section-title {
            color: #0c4a6e;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .tab-button.active {
            border-bottom-color: #0369a1;
            color: #0369a1;
            font-weight: 600;
        }
        .process-arrow {
            font-size: 2rem;
            color: #57534e;
        }
        #kg-graph-container {
            position: relative;
            min-height: 500px;
            border: 1px solid #e7e5e4;
            background-image: radial-gradient(#d6d3d1 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: auto;
        }
        .kg-node {
            position: absolute;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .kg-node:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        .kg-edge {
            position: absolute;
            background-color: #a8a29e;
            height: 2px;
            transform-origin: 0 0;
            z-index: 1;
        }
        .kg-edge-label {
            position: absolute;
            font-size: 0.75rem;
            color: #78716c;
            background-color: #f8f7f4;
            padding: 0 4px;
            border-radius: 4px;
            z-index: 2;
        }
        .tooltip {
            position: absolute;
            display: none;
            background-color: #292524;
            color: #f5f5f4;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            z-index: 100;
            pointer-events: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .highlight {
            border: 2px solid #ea580c;
            box-shadow: 0 0 15px rgba(234, 88, 12, 0.5);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold section-title mb-2">ë²•ë¥  AIë¥¼ ìœ„í•œ ì‹ ê²½-ìƒì§• ì•„í‚¤í…ì²˜</h1>
            <p class="text-lg text-stone-600">ë¯¼ì‚¬ì†Œì†¡ê¸°ë¡(2025-07) ê¸°ë°˜ ëŒ€í™”í˜• ì‚¬ë¡€ ì—°êµ¬</p>
        </header>

        <main>
            <section id="intro" class="mb-16">
                <p class="max-w-4xl mx-auto text-center text-lg leading-relaxed mb-8">
                    ë³¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë²•ë¥  ë¬¸ì„œì˜ ë¯¸ë¬˜í•œ ì˜ë¯¸ë¥¼ íŒŒì•…í•˜ëŠ” ì‹ ê²½ë§(LLM)ì˜ 'ì¸ì‹' ëŠ¥ë ¥ê³¼, ë²•ë¥  ê·œì¹™ì˜ ì—„ê²©í•œ ë…¼ë¦¬ë¥¼ ë”°ë¥´ëŠ” ìƒì§• ì‹œìŠ¤í…œ(ì§€ì‹ ê·¸ë˜í”„)ì˜ 'ì¶”ë¡ ' ëŠ¥ë ¥ì„ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ AI ì•„í‚¤í…ì²˜ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤. LLMì˜ í™˜ê°ì„ ì–µì œí•˜ê³  ì‹ ë¢°ë„ì™€ ì„¤ëª…ê°€ëŠ¥ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” ê³¼ì •ì„ ì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”.
                </p>
                <div class="max-w-5xl mx-auto p-8 card text-center cursor-pointer" onclick="document.getElementById('process-diagram').scrollIntoView({ behavior: 'smooth' });">
                    <h2 class="text-2xl font-bold section-title mb-4">í•µì‹¬ í”„ë¡œì„¸ìŠ¤ íƒìƒ‰í•˜ê¸°</h2>
                    <p class="text-stone-600 mb-6">ì•„ë˜ ë‹¤ì´ì–´ê·¸ë¨ì˜ ê° ë‹¨ê³„ë¥¼ í´ë¦­í•˜ì—¬ ì§€ì‹ì´ ì–´ë–»ê²Œ ì¶”ì¶œ, êµ¬ì¡°í™”, í™œìš©ë˜ëŠ”ì§€ ë‹¨ê³„ë³„ë¡œ ì‚´í´ë³´ì„¸ìš”.</p>
                    <div id="process-diagram" class="flex flex-col md:flex-row items-center justify-center gap-4 text-center">
                        <div class="p-4 bg-sky-100 text-sky-800 rounded-lg">
                            <h3 class="font-bold">ë¹„ì •í˜• ë°ì´í„°</h3>
                            <p class="text-sm">ì†Œì†¡ ê¸°ë¡</p>
                        </div>
                        <div class="process-arrow">â†’</div>
                        <div id="nav-phase1" class="p-6 rounded-lg bg-amber-100 border-2 border-amber-200 cursor-pointer hover:bg-amber-200 transition">
                            <h3 class="font-bold text-amber-800">1ë‹¨ê³„ (ì‹ ê²½ë§ â†’ ìƒì§•)</h3>
                            <p class="text-sm text-amber-700">ì§€ì‹ ê·¸ë˜í”„ êµ¬ì¶•</p>
                        </div>
                        <div class="process-arrow">â†’</div>
                        <div id="nav-phase2" class="p-6 rounded-lg bg-emerald-100 border-2 border-emerald-200 cursor-pointer hover:bg-emerald-200 transition">
                            <h3 class="font-bold text-emerald-800">2ë‹¨ê³„ (ìƒì§• â†’ ì‹ ê²½ë§)</h3>
                            <p class="text-sm text-emerald-700">ê·¸ë˜í”„ ê¸°ë°˜ ì¶”ë¡ </p>
                        </div>
                        <div class="process-arrow">â†’</div>
                         <div class="p-4 bg-sky-100 text-sky-800 rounded-lg">
                            <h3 class="font-bold">ì„¤ëª…ê°€ëŠ¥í•œ ë‹µë³€</h3>
                            <p class="text-sm">ê·¼ê±° ê¸°ë°˜ ë¶„ì„</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="phase1" class="mb-16">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold section-title">1ë‹¨ê³„: ë¹„ì •í˜• ê¸°ë¡ìœ¼ë¡œë¶€í„° ì§€ì‹ ê·¸ë˜í”„ êµ¬ì¶•</h2>
                    <p class="text-stone-600 mt-2 max-w-3xl mx-auto">LLMì„ ì‚¬ìš©í•´ ì†Œì†¡ ê¸°ë¡ í…ìŠ¤íŠ¸ì—ì„œ ë²•ë¥ ì  ê°œì²´ì™€ ê´€ê³„ë¥¼ ì¶”ì¶œí•˜ì—¬, ê¸°ê³„ê°€ ì½ê³  ë¶„ì„í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°í™”ëœ ì§€ì‹ ê·¸ë˜í”„(KG)ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
                </div>

                <div class="card p-6 md:p-8">
                    <div class="mb-6 border-b border-stone-200">
                        <nav class="flex space-x-8 -mb-px" id="phase1-tabs">
                            <button data-tab="disputes" class="tab-button py-4 px-1 text-base font-medium text-stone-500 hover:text-sky-700">ë¶„ìŸ ì‚¬ë¡€ íƒìƒ‰ê¸°</button>
                            <button data-tab="ontology" class="tab-button py-4 px-1 text-base font-medium text-stone-500 hover:text-sky-700">ì˜¨í†¨ë¡œì§€ ìŠ¤í‚¤ë§ˆ</button>
                            <button data-tab="ledger" class="tab-button py-4 px-1 text-base font-medium text-stone-500 hover:text-sky-700">ë§ˆìŠ¤í„° ê°œì²´ ëŒ€ì¥</button>
                             <button data-tab="chart" class="tab-button py-4 px-1 text-base font-medium text-stone-500 hover:text-sky-700">ë¶„ìŸ ê°€ì¹˜ ë¹„êµ</button>
                        </nav>
                    </div>

                    <div id="phase1-content">
                        
                    </div>
                </div>
            </section>
            
            <section id="phase2" class="mb-16">
                 <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold section-title">2ë‹¨ê³„: ê·¸ë˜í”„ ê¸°ë°˜ì˜ ì„¤ëª… ê°€ëŠ¥í•œ ì¶”ë¡  (Graph-RAG)</h2>
                    <p class="text-stone-600 mt-2 max-w-3xl mx-auto">êµ¬ì¶•ëœ ì§€ì‹ ê·¸ë˜í”„ë¥¼ 'ì§„ì‹¤ì˜ ì›ì²œ'ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ LLMì˜ ì¶”ë¡  ê³¼ì •ì„ ì•ˆë‚´í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‚¬ì‹¤ì— ê·¼ê±°í•˜ê³  ëª¨ë“  ê²°ë¡ ì„ ì—­ì¶”ì í•  ìˆ˜ ìˆëŠ” íˆ¬ëª…í•œ ë¶„ì„ ê²°ê³¼ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="card p-6 md:p-8" id="rag-container">
                </div>
            </section>

             <section id="conclusion" class="text-center">
                <h2 class="text-3xl font-bold section-title mb-4">ê²°ë¡ : ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë²•ë¥  AI</h2>
                <div class="grid md:grid-cols-3 gap-8 max-w-6xl mx-auto mt-8">
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-sky-800 mb-2">âœ”ï¸ í™˜ê° í˜„ìƒ ì–µì œ</h3>
                        <p class="text-sm text-stone-600">AIì˜ ì¶”ë¡ ì´ ê²€ì¦ëœ ì§€ì‹ ê·¸ë˜í”„ì˜ ì‚¬ì‹¤ì—ë§Œ ì—„ê²©íˆ êµ¬ì†ë˜ì–´, ì‚¬ì‹¤ì´ ì•„ë‹Œ ì •ë³´ë¥¼ ìƒì„±í•  ìœ„í—˜ì„ ê·¹ì ìœ¼ë¡œ ë‚®ì¶¥ë‹ˆë‹¤.</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-sky-800 mb-2">ğŸ” ë‚´ì¬ëœ ì„¤ëª…ê°€ëŠ¥ì„±</h3>
                        <p class="text-sm text-stone-600">ëª¨ë“  ë¶„ì„ ê²°ê³¼ëŠ” ì§€ì‹ ê·¸ë˜í”„ì˜ íŠ¹ì • ë…¸ë“œë¡œ, ë‚˜ì•„ê°€ ì›ë³¸ ë¬¸ì„œì˜ êµ¬ì ˆê¹Œì§€ ì—­ì¶”ì ì´ ê°€ëŠ¥í•˜ì—¬ AI íŒë‹¨ì˜ ê·¼ê±°ë¥¼ íˆ¬ëª…í•˜ê²Œ ì œì‹œí•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="card p-6">
                        <h3 class="font-bold text-lg text-sky-800 mb-2">ğŸ•¸ï¸ ì „ì²´ë¡ ì  ë¶„ì„</h3>
                        <p class="text-sm text-stone-600">ì‚¬ê±´ë“¤ ì‚¬ì´ì˜ ìˆ¨ê²¨ì§„ ì—°ê²°ê³ ë¦¬ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë“œëŸ¬ë‚´ì–´, ë‹¨ìˆœ í…ìŠ¤íŠ¸ ë¶„ì„ìœ¼ë¡œëŠ” íŒŒì•…í•˜ê¸° ì–´ë ¤ìš´ ì‚¬ê±´ì˜ ì „ì²´ êµ¬ì¡°ì— ëŒ€í•œ ê¹Šì€ ì´í•´ë¥¼ ë•ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <div id="tooltip" class="tooltip"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const appData = {
        ontology: {
            nodes: [
                { name: 'Person', desc: 'ê°œì¸ (ì›ê³ , í”¼ê³  ë“±)' },
                { name: 'Corporation', desc: 'ë²•ì¸' },
                { name: 'Property', desc: 'ì¬ì‚° (ë¶€ë™ì‚° ë“±)' },
                { name: 'Contract', desc: 'ê³„ì•½ (ë§¤ë§¤, ì„ëŒ€ì°¨ ë“±)' },
                { name: 'Debt', desc: 'ì±„ë¬´' },
                { name: 'SecurityInterest', desc: 'ë‹´ë³´ë¬¼ê¶Œ (ê·¼ì €ë‹¹ê¶Œ ë“±)' },
                { name: 'LegalEvent', desc: 'ë²•ë¥  ì‚¬ê±´ (ì†Œì œê¸°, ê²½ë§¤ ë“±)' },
                { name: 'Document', desc: 'ë¬¸ì„œ (ê³„ì•½ì„œ, ë“±ê¸°ë¶€ ë“±)' },
                { name: 'LegalClaim', desc: 'ë²•ì  ì£¼ì¥' },
            ],
            edges: [
                { name: 'HAS_PARTY', desc: 'ë‹¹ì‚¬ì ê´€ê³„' },
                { name: 'IS_SECURED_BY', desc: 'ë‹´ë³´ ê´€ê³„' },
                { name: 'TRANSFERRED_TO', desc: 'ê¶Œë¦¬ ì´ì „ ê´€ê³„' },
                { name: 'ALLEGES', desc: 'ì£¼ì¥ ê´€ê³„' },
                { name: 'EVIDENCED_BY', desc: 'ì¦ê±° ê´€ê³„' },
                { name: 'OCCURRED_ON', desc: 'ë°œìƒ ì‹œì  ê´€ê³„' },
            ]
        },
        ledger: [
            { id: "Person_KangYongwon", name: "ê°•ìš©ì›", type: "Person", date: "1947-12-11", value: "-", doc: "ì˜ë¢°ì¸ ìƒë‹´ì¼ì§€" },
            { id: "Person_OhMinhan", name: "ì˜¤ë¯¼í•œ", type: "Person", date: "1954-06-07", value: "-", doc: "ì˜ì—…ì–‘ë„ ê³„ì•½ì„œ" },
            { id: "Person_LeeMunho", name: "ì´ë¬¸í˜¸", type: "Person", date: "1964-10-03", value: "-", doc: "ë“±ê¸°ì‚¬í•­ì „ë¶€ì¦ëª…ì„œ" },
            { id: "Corporation_DaehanBank", name: "ì£¼ì‹íšŒì‚¬ ëŒ€í•œì€í–‰", type: "Corporation", date: "-", value: "-", doc: "ë“±ê¸°ì‚¬í•­ì „ë¶€ì¦ëª…ì„œ" },
            { id: "RealEstate_SeongsuLand", name: "ì„±ìˆ˜ë™ ëŒ€ì§€", type: "ë¶€ë™ì‚°", date: "-", value: "-", doc: "ë³„ì§€ ëª©ë¡" },
            { id: "RealEstate_SinlimStore", name: "ì‹ ë¦¼ë™ ìƒê°€", type: "ë¶€ë™ì‚°", date: "-", value: "2.4ì–µ ì›", doc: "ë³„ì§€ ëª©ë¡" },
            { id: "RealEstate_PyeongtaekVilla", name: "í‰íƒì‹œ ë¹Œë¼", type: "ë¶€ë™ì‚°", date: "-", value: "-", doc: "ë³„ì§€ ëª©ë¡" },
            { id: "Debt_HaeDream", name: "í•´ë“œë¦¼ ë¬¼í’ˆëŒ€ê¸ˆ ì±„ë¬´", type: "ì±„ë¬´", date: "2021-06-05", value: "2ì–µ ì›", doc: "ì˜ë¢°ì¸ ìƒë‹´ì¼ì§€" },
            { id: "Loan_Seongsu_2", name: "ì„±ìˆ˜ë™ 2ì°¨ ì°¨ìš©ê¸ˆ", type: "ëŒ€ì—¬ê¸ˆ", date: "2023-07-06", value: "3ì–µ ì›", doc: "ì°¨ìš©ì¦" },
            { id: "Lien_Pyeongtaek", name: "í‰íƒì‹œ ë¹Œë¼ ìœ ì¹˜ê¶Œ", type: "ìœ ì¹˜ê¶Œ", date: "-", value: "3ì–µ ì›", doc: "ê³µì‚¬ë„ê¸‰ ê³„ì•½ì„œ" },
        ],
        disputes: {
            dispute1: {
                title: "ë¶„ìŸ 1: 'í•´ë“œë¦¼' ì±„ê¶Œê³¼ ì†Œë©¸ì‹œíš¨",
                summary: "ì¸í…Œë¦¬ì–´ ìì¬ëŒ€ê¸ˆ ì±„ê¶Œ(2ì–µ)ì„ ì˜ì—…ì–‘ìˆ˜ì¸ ì˜¤ë¯¼í•œì—ê²Œ ì²­êµ¬í•˜ëŠ” ì‚¬ê±´ì…ë‹ˆë‹¤. ì˜ì—…ì–‘ìˆ˜ì¸ì˜ ì±…ì„, ë‹¨ê¸°ì†Œë©¸ì‹œíš¨, ê·¸ë¦¬ê³  ì–‘ë„ì¸ì˜ ì±„ë¬´ìŠ¹ì¸ íš¨ë ¥ì´ ì£¼ìš” ìŸì ì…ë‹ˆë‹¤.",
                issues: ["ìƒë²•ìƒ ì˜ì—…ì–‘ìˆ˜ì¸ì˜ ì±…ì„", "ìƒì‚¬ì±„ê¶Œì˜ ì†Œë©¸ì‹œíš¨(3ë…„)", "ì†Œë©¸ì‹œíš¨ ì¤‘ë‹¨(ì±„ë¬´ìŠ¹ì¸)ì˜ íš¨ê³¼ ë²”ìœ„"],
                nodes: [
                    { id: 'p1', label: 'ê°•ìš©ì›(ì±„ê¶Œì)', x: 50, y: 150, type: 'Person', details: 'ì›ê³ , í•´ë“œë¦¼ ì±„ê¶Œì˜ ì±„ê¶Œì' },
                    { id: 'p2', label: 'ê¹€ì„ ì›…(ì–‘ë„ì¸)', x: 300, y: 50, type: 'Person', details: 'í•´ë“œë¦¼ ì›ë˜ ì±„ë¬´ì, ì˜ì—… ì–‘ë„ì¸' },
                    { id: 'p3', label: 'ì˜¤ë¯¼í•œ(ì–‘ìˆ˜ì¸)', x: 300, y: 250, type: 'Person', details: 'í•´ë“œë¦¼ ì˜ì—… ì–‘ìˆ˜ì¸, í”¼ê³ ' },
                    { id: 'd1', label: 'í•´ë“œë¦¼ ì±„ê¶Œ(2ì–µ)', x: 175, y: 150, type: 'Debt', details: '2021-06-05 ë°œìƒ' },
                    { id: 'e1', label: 'ì˜ì—…ì–‘ë„', x: 450, y: 150, type: 'LegalEvent', details: '2024-07-05, ìƒí˜¸ "í•´ë“œë¦¼" ì†ìš©' },
                    { id: 'e2', label: 'ì±„ë¬´ìŠ¹ì¸(ê°ì„œ)', x: 450, y: 50, type: 'LegalEvent', details: '2024-08-05, ì–‘ë„ì¸ ê¹€ì„ ì›…ì´ ì‘ì„±' },
                ],
                edges: [
                    { from: 'p1', to: 'd1', label: 'ì±„ê¶Œ ë³´ìœ ' },
                    { from: 'd1', to: 'p2', label: 'ì›ì±„ë¬´ì' },
                    { from: 'p2', to: 'e1', label: 'ì–‘ë„' },
                    { from: 'e1', to: 'p3', label: 'ì–‘ìˆ˜' },
                    { from: 'p2', to: 'e2', label: 'ì‘ì„±' },
                ]
            },
            dispute2: {
                title: "ë¶„ìŸ 2: ì„±ìˆ˜ë™ ëŒ€ì§€ì™€ ë¬´íš¨ì¸ ê²½ë§¤",
                summary: "ê°•ìš©ì›ì´ ì˜¤ë¯¼í•œì—ê²Œ 4ì–µì›ì„ ë³€ì œí–ˆìœ¼ë‚˜, ì˜¤ë¯¼í•œì´ ë¬´íš¨ê°€ ëœ ê·¼ì €ë‹¹ê¶Œì— ê¸°í•´ ê²½ë§¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ì œ3ìì—ê²Œ ì†Œìœ ê¶Œì´ ë„˜ì–´ê°„ ì‚¬ê±´ì…ë‹ˆë‹¤. ë²•ì •ë³€ì œì¶©ë‹¹ì´ í•µì‹¬ ìŸì ì…ë‹ˆë‹¤.",
                issues: ["ë¯¼ë²•ìƒ ë²•ì •ë³€ì œì¶©ë‹¹", "í”¼ë‹´ë³´ì±„ë¬´ ì†Œë©¸ê³¼ ê·¼ì €ë‹¹ê¶Œì˜ íš¨ë ¥", "ë¬´íš¨ì¸ ê²½ë§¤ì™€ ì†Œìœ ê¶Œ ì´ì „ì˜ íš¨ë ¥", "ë¶€ë™ì‚° ë“±ê¸°ì˜ ê³µì‹ ë ¥ ë¶€ì¸"],
                nodes: [
                    { id: 'p1', label: 'ê°•ìš©ì›(ì±„ë¬´ì)', x: 50, y: 250, type: 'Person', details: 'ì„±ìˆ˜ë™ ëŒ€ì§€ ì›ì†Œìœ ì'},
                    { id: 'p2', label: 'ì˜¤ë¯¼í•œ(ì±„ê¶Œì)', x: 350, y: 100, type: 'Person', details: '2ê±´ì˜ ëŒ€ì—¬ê¸ˆ ì±„ê¶Œì'},
                    { id: 'p3', label: 'ì´ë¬¸í˜¸(ê²½ë½ì¸)', x: 650, y: 250, type: 'Person', details: 'ë¬´íš¨ ê²½ë§¤ë¡œ ì†Œìœ ê¶Œ ì·¨ë“'},
                    { id: 'c1', label: '2ì–µ ëŒ€ì—¬ê¸ˆ(ì´ì 10%)', x: 200, y: 50, type: 'Debt', details: '1ìˆœìœ„ ê·¼ì €ë‹¹ê¶Œ'},
                    { id: 'c2', label: '3ì–µ ëŒ€ì—¬ê¸ˆ(ì´ì 15%)', x: 200, y: 150, type: 'Debt', details: '2ìˆœìœ„ ê·¼ì €ë‹¹ê¶Œ'},
                    { id: 'e1', label: '4ì–µ ë³€ì œ', x: 200, y: 300, type: 'LegalEvent', details: '2024-07-05, ì±„ë¬´ ë¯¸ì§€ì •'},
                    { id: 'e2', label: 'ê²½ë§¤ ì‹¤í–‰', x: 500, y: 175, type: 'LegalEvent', details: 'ë¬´íš¨ì¸ 2ìˆœìœ„ ê·¼ì €ë‹¹ê¶Œì— ê¸°í•¨'},
                    { id: 'prop', label: 'ì„±ìˆ˜ë™ ëŒ€ì§€', x: 350, y: 350, type: 'Property', details: 'ë¶„ìŸì˜ ëŒ€ìƒ ë¶€ë™ì‚°'},
                ],
                edges: [
                    { from: 'p1', to: 'c1', label: 'ì±„ë¬´' },
                    { from: 'p1', to: 'c2', label: 'ì±„ë¬´' },
                    { from: 'c1', to: 'p2', label: 'ì±„ê¶Œ' },
                    { from: 'c2', to: 'p2', label: 'ì±„ê¶Œ' },
                    { from: 'p1', to: 'e1', label: 'ë³€ì œ' },
                    { from: 'e1', to: 'p2', label: 'ìˆ˜ë ¹' },
                    { from: 'p2', to: 'e2', label: 'ì‹¤í–‰' },
                    { from: 'e2', to: 'p3', label: 'ë‚™ì°°' },
                    { from: 'c1', to: 'prop', label: 'ë‹´ë³´' },
                    { from: 'c2', to: 'prop', label: 'ë‹´ë³´' },
                ]
            },
            dispute3: {
                title: "ë¶„ìŸ 3: ì‹ ë¦¼ë™ ìƒê°€ì™€ ì‚¬í•´í–‰ìœ„",
                summary: "ì±„ë¬´ì ì˜¤êµ­í•œì´ ìœ ì¼í•œ ì¬ì‚°ì¸ ì‹ ë¦¼ë™ ìƒê°€ë¥¼ ì¹œì¡± ì˜¤ë¯¼í•œì—ê²Œ ì´ì „í•œ í–‰ìœ„ê°€ ì±„ê¶Œì ê°•ìš©ì›ì— ëŒ€í•œ ì‚¬í•´í–‰ìœ„ì— í•´ë‹¹í•˜ëŠ”ì§€ê°€ ë¬¸ì œë˜ëŠ” ì‚¬ê±´ì…ë‹ˆë‹¤.",
                issues: ["ì‚¬í•´í–‰ìœ„ ì·¨ì†Œê¶Œ", "ì±„ë¬´ìì˜ ë¬´ìë ¥ ë° ì‚¬í•´ì˜ì‚¬", "ìˆ˜ìµìì˜ ì•…ì˜ ì¶”ì •", "ê³„ì•½ëª…ì˜ì‹ íƒê³¼ ì¬ì‚° ê·€ì†"],
                nodes: [
                    { id: 'p1', label: 'ê°•ìš©ì›(ì±„ê¶Œì)', x: 50, y: 150, type: 'Person', details: 'ì˜¤êµ­í•œì— ëŒ€í•œ ì±„ê¶Œì'},
                    { id: 'p2', label: 'ì˜¤êµ­í•œ(ì±„ë¬´ì)', x: 300, y: 150, type: 'Person', details: 'ì±„ë¬´ì´ˆê³¼ ìƒíƒœì—ì„œ ì¬ì‚° ì²˜ë¶„'},
                    { id: 'p3', label: 'ì˜¤ë¯¼í•œ(ìˆ˜ìµì)', x: 550, y: 150, type: 'Person', details: 'ì˜¤êµ­í•œìœ¼ë¡œë¶€í„° ìƒê°€ ë§¤ìˆ˜'},
                    { id: 'prop', label: 'ì‹ ë¦¼ë™ ìƒê°€', x: 425, y: 250, type: 'Property', details: 'ì˜¤êµ­í•œì˜ ìœ ì¼í•œ ì¬ì‚°'},
                    { id: 'e1', label: 'ë¶€ë™ì‚° ë§¤ë§¤', x: 425, y: 150, type: 'LegalEvent', details: '2023-03-17, ì‚¬í•´í–‰ìœ„ë¡œ ì˜ì‹¬ë¨'},
                ],
                edges: [
                    { from: 'p1', to: 'p2', label: 'ì±„ê¶Œ' },
                    { from: 'p2', to: 'e1', label: 'ë§¤ë„' },
                    { from: 'e1', to: 'p3', label: 'ë§¤ìˆ˜' },
                    { from: 'e1', to: 'prop', label: 'ëŒ€ìƒ' },
                ]
            },
            dispute4: {
                title: "ë¶„ìŸ 4: í‰íƒ ë¹Œë¼ ìœ ì¹˜ê¶Œê³¼ ì„ ê´€ì£¼ì˜ì˜ë¬´",
                summary: "ìœ ì¹˜ê¶Œì ë°•ê´‘ìœ¤ì´ ì†Œìœ ì ë™ì˜ ì—†ì´ ìœ ì¹˜ë¬¼ì„ ë¬´ë‹¨ìœ¼ë¡œ ì„ëŒ€í•˜ê³  ê±°ì£¼í•˜ì—¬ ì„ ê´€ì£¼ì˜ì˜ë¬´ë¥¼ ìœ„ë°˜í•˜ì, ìƒì†ì¸ì¸ ê°•ìš©ì›ì´ ìœ ì¹˜ê¶Œ ì†Œë©¸ì„ ì²­êµ¬í•œ ì‚¬ê±´ì…ë‹ˆë‹¤.",
                issues: ["ìœ ì¹˜ê¶Œìì˜ ì„ ê´€ì£¼ì˜ì˜ë¬´", "ì˜ë¬´ìœ„ë°˜ê³¼ ìœ ì¹˜ê¶Œ ì†Œë©¸ì²­êµ¬", "ë¶€ë‹¹ì´ë“ë°˜í™˜ì˜ë¬´"],
                nodes: [
                    { id: 'p1', label: 'ê°•ìš©ì›(ì†Œìœ ì)', x: 50, y: 150, type: 'Person', details: 'ë¹Œë¼ ìƒì†ì¸'},
                    { id: 'p2', label: 'ë°•ê´‘ìœ¤(ìœ ì¹˜ê¶Œì)', x: 300, y: 150, type: 'Person', details: 'ê³µì‚¬ëŒ€ê¸ˆ 3ì–µ ì±„ê¶Œ'},
                    { id: 'prop', label: 'í‰íƒì‹œ ë¹Œë¼', x: 175, y: 250, type: 'Property', details: 'ìœ ì¹˜ê¶Œ ëª©ì ë¬¼'},
                    { id: 'e1', label: 'ë¬´ë‹¨ ì„ëŒ€/ì‚¬ìš©', x: 450, y: 150, type: 'LegalEvent', details: 'ì„ ê´€ì£¼ì˜ì˜ë¬´ ìœ„ë°˜ í–‰ìœ„'},
                    { id: 'e2', label: 'ìœ ì¹˜ê¶Œ ì†Œë©¸ì²­êµ¬', x: 175, y: 50, type: 'LegalEvent', details: 'ê°•ìš©ì›ì´ ë°•ê´‘ìœ¤ì—ê²Œ í†µì§€'},
                ],
                edges: [
                    { from: 'p2', to: 'prop', label: 'ìœ ì¹˜' },
                    { from: 'p1', to: 'prop', label: 'ì†Œìœ ' },
                    { from: 'p2', to: 'e1', label: 'ìœ„ë°˜ í–‰ìœ„' },
                    { from: 'p1', to: 'e2', label: 'ì²­êµ¬' },
                    { from: 'e2', to: 'p2', label: 'ëŒ€ìƒ' },
                ]
            },
            dispute5: {
                title: "ë¶„ìŸ 5: í‘ì„ë™ ìƒê°€ì™€ ê³„ì•½í•´ì œ",
                summary: "ìƒê°€ ë§¤ìˆ˜ì¸ìœ¼ë¡œë¶€í„° ìƒê°€ë¥¼ ì„ì°¨í•˜ì—¬ ëŒ€í•­ë ¥ì„ ê°–ì¶˜ ì„ì°¨ì¸ ì–‘ì •ìˆ™ì´, ì› ë§¤ë§¤ê³„ì•½ì´ í•´ì œëœ í›„ ì› ì†Œìœ ìì—ê²Œ ìì‹ ì˜ ì„ì°¨ê¶Œì„ ì£¼ì¥í•  ìˆ˜ ìˆëŠ”ì§€ê°€ ë¬¸ì œë©ë‹ˆë‹¤.",
                issues: ["ìƒê°€ì„ëŒ€ì°¨ë³´í˜¸ë²•ìƒ ëŒ€í•­ë ¥", "ê³„ì•½í•´ì œì™€ ì œ3ì ë³´í˜¸ (ë¯¼ë²• ì œ548ì¡°)"],
                nodes: [
                    { id: 'p1', label: 'ìœ¤ê±´ìš°(ì›ì†Œìœ ì)', x: 50, y: 150, type: 'Person', details: 'ë§¤ë„ì¸, ê³„ì•½ í•´ì œê¶Œ í–‰ì‚¬'},
                    { id: 'p2', label: 'ì´ìˆ˜ì¸(ë§¤ìˆ˜ì¸)', x: 300, y: 150, type: 'Person', details: 'ë§¤ë§¤ëŒ€ê¸ˆ ë¯¸ì§€ê¸‰ìœ¼ë¡œ ê³„ì•½ í•´ì œë¨'},
                    { id: 'p3', label: 'ì–‘ì •ìˆ™(ì„ì°¨ì¸)', x: 550, y: 150, type: 'Person', details: 'ëŒ€í•­ë ¥ ê°–ì¶˜ ì„ì°¨ì¸'},
                    { id: 'e1', label: 'ë§¤ë§¤ê³„ì•½', x: 175, y: 150, type: 'LegalEvent', details: '2023-10-01 ì²´ê²°'},
                    { id: 'e2', label: 'ì„ëŒ€ì°¨ê³„ì•½', x: 425, y: 150, type: 'LegalEvent', details: '2024-02-01 ëŒ€í•­ë ¥ ì·¨ë“'},
                    { id: 'e3', label: 'ë§¤ë§¤ê³„ì•½ í•´ì œ', x: 175, y: 50, type: 'LegalEvent', details: '2024-05-15 ë°œìƒ'},
                ],
                edges: [
                    { from: 'p1', to: 'e1', label: 'ë§¤ë„' },
                    { from: 'e1', to: 'p2', label: 'ë§¤ìˆ˜' },
                    { from: 'p2', to: 'e2', label: 'ì„ëŒ€' },
                    { from: 'e2', to: 'p3', label: 'ì„ì°¨' },
                    { from: 'p1', to: 'e3', label: 'í•´ì œ' },
                ]
            }
        },
        rag: {
            query: "ê°•ìš©ì›ì€ ì„±ìˆ˜ë™ ëŒ€ì§€ì™€ ê´€ë ¨í•˜ì—¬ ìì‹ ì´ ê°€ì§€ëŠ” ëª¨ë“  ê¶Œë¦¬ë¥¼ ì‹¤í˜„í•˜ê¸° ìœ„í•œ ì†Œì˜ ì œê¸°ë¥¼ í¬ë§í•œë‹¤.",
            subgraph: {
                nodes: [
                    { id: 'p1', label: 'ê°•ìš©ì›', type: 'Person'},
                    { id: 'p2', label: 'ì˜¤ë¯¼í•œ', type: 'Person'},
                    { id: 'p3', label: 'ì´ë¬¸í˜¸', type: 'Person'},
                    { id: 'p4', label: 'ëŒ€í•œì€í–‰', type: 'Corporation'},
                    { id: 'e1', label: '4ì–µ ë³€ì œ', type: 'LegalEvent'},
                    { id: 'e2', label: 'ê²½ë§¤ ì‹¤í–‰', type: 'LegalEvent'},
                    { id: 'c2', label: '3ì–µ ëŒ€ì—¬ê¸ˆ(15%)', type: 'Debt'},
                    { id: 'r1', label: 'ë¯¼ë²• ì œ477ì¡°', type: 'Rule'},
                    { id: 'r2', label: 'ë“±ê¸° ë¬´ê³µì‹ ë ¥', type: 'Rule'},
                ],
            },
            analysis: `
                <h4 class="font-bold text-lg mb-4 text-sky-800">ì œëª©: ê°•ìš©ì›ì˜ ì„±ìˆ˜ë™ ëŒ€ì§€ ê´€ë ¨ ê¶Œë¦¬ ì‹¤í˜„ì„ ìœ„í•œ ë²•ì  ì²­êµ¬ ë¶„ì„</h4>
                <div class="space-y-4 text-sm">
                    <div class="p-4 bg-stone-50 rounded-md border">
                        <p class="font-bold">ê°€. ì´ë¬¸í˜¸(<span class="rag-ref" data-node="p3">p3</span>)ì— ëŒ€í•œ ì²­êµ¬: ì†Œìœ ê¶Œì´ì „ë“±ê¸° ë§ì†Œì²­êµ¬</p>
                        <p class="mt-1 text-stone-600"><strong>ë²•ì  ê·¼ê±°:</strong> ì´ë¬¸í˜¸ê°€ ì†Œìœ ê¶Œì„ ì·¨ë“í•œ ê²½ë§¤(<span class="rag-ref" data-node="e2">e2</span>)ëŠ” ë¬´íš¨ì…ë‹ˆë‹¤. ê°•ìš©ì›ì€ 4ì–µ ì›ì„ ë³€ì œ(<span class="rag-ref" data-node="e1">e1</span>)í•˜ë©´ì„œ ì±„ë¬´ë¥¼ íŠ¹ì •í•˜ì§€ ì•Šì•„ ë²•ì •ë³€ì œì¶©ë‹¹(<span class="rag-ref" data-node="r1">r1</span>) ê·œì •ì— ë”°ë¼ ì´ììœ¨ì´ ë†’ì€ 3ì–µ ì› ì±„ë¬´(<span class="rag-ref" data-node="c2">c2</span>)ê°€ ë¨¼ì € ì†Œë©¸í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ í•´ë‹¹ ì±„ë¬´ë¥¼ ë‹´ë³´í•˜ë˜ ê·¼ì €ë‹¹ê¶Œì— ê¸°í•œ ê²½ë§¤ëŠ” ì›ì¸ë¬´íš¨ì´ë©°, ë“±ê¸°ì˜ ê³µì‹ ë ¥ì´ ì—†ìœ¼ë¯€ë¡œ(<span class="rag-ref" data-node="r2">r2</span>) ì´ë¬¸í˜¸ì˜ ë“±ê¸°ëŠ” ë¬´íš¨ì…ë‹ˆë‹¤.</p>
                    </div>
                    <div class="p-4 bg-stone-50 rounded-md border">
                        <p class="font-bold">ë‚˜. ì£¼ì‹íšŒì‚¬ ëŒ€í•œì€í–‰(<span class="rag-ref" data-node="p4">p4</span>)ì— ëŒ€í•œ ì²­êµ¬: ê·¼ì €ë‹¹ê¶Œì„¤ì •ë“±ê¸° ë§ì†Œì²­êµ¬</p>
                        <p class="mt-1 text-stone-600"><strong>ë²•ì  ê·¼ê±°:</strong> ëŒ€í•œì€í–‰ì˜ ê·¼ì €ë‹¹ê¶Œì€ ë¬´íš¨ì¸ ì´ë¬¸í˜¸(<span class="rag-ref" data-node="p3">p3</span>)ì˜ ì†Œìœ ê¶Œì„ ì „ì œë¡œ ì„¤ì •ë˜ì—ˆìœ¼ë¯€ë¡œ, ë²•ë¥ ìƒ ì›ì¸ì´ ì—†ëŠ” ë¬´íš¨ì˜ ë“±ê¸°ì…ë‹ˆë‹¤.</p>
                    </div>
                     <div class="p-4 bg-stone-50 rounded-md border">
                        <p class="font-bold">ë¼. ì˜¤ë¯¼í•œ(<span class="rag-ref" data-node="p2">p2</span>)ì— ëŒ€í•œ ì²­êµ¬: ë¶ˆë²•í–‰ìœ„ë¡œ ì¸í•œ ì†í•´ë°°ìƒì²­êµ¬</p>
                        <p class="mt-1 text-stone-600"><strong>ë²•ì  ê·¼ê±°:</strong> ì˜¤ë¯¼í•œì€ ë³€ì œ(<span class="rag-ref" data-node="e1">e1</span>)ë¡œ ê·¼ì €ë‹¹ê¶Œì´ ì†Œë©¸í–ˆìŒì„ ì•Œì•˜ê±°ë‚˜ ì•Œ ìˆ˜ ìˆì—ˆìŒì—ë„ ê³ ì˜/ê³¼ì‹¤ë¡œ ë¬´íš¨ì¸ ê²½ë§¤ë¥¼ ì‹¤í–‰(<span class="rag-ref" data-node="e2">e2</span>)í•˜ì—¬ ê°•ìš©ì›(<span class="rag-ref" data-node="p1">p1</span>)ì—ê²Œ ì†í•´ë¥¼ ì…í˜”ìœ¼ë¯€ë¡œ ë¶ˆë²•í–‰ìœ„ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            `
        }
    };

    const phase1Content = document.getElementById('phase1-content');
    const phase1Tabs = document.getElementById('phase1-tabs');
    const ragContainer = document.getElementById('rag-container');
    const tooltip = document.getElementById('tooltip');
    
    let activeDispute = 'dispute1';
    let activeTab = 'disputes';
    let ragStep = 0;
    
    function renderPhase1() {
        phase1Tabs.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.tab === activeTab);
        });

        let html = '';
        if (activeTab === 'disputes') {
            html = `
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    ${Object.entries(appData.disputes).map(([key, val]) => `
                        <div id="dispute-card-${key}" data-dispute="${key}" class="card p-5 cursor-pointer dispute-card ${key === activeDispute ? 'ring-2 ring-sky-600' : ''}">
                            <h4 class="font-bold text-lg text-sky-800 mb-2">${val.title}</h4>
                            <p class="text-sm text-stone-600">${val.summary}</p>
                        </div>
                    `).join('')}
                </div>
                <div id="dispute-details" class="fade-in"></div>
            `;
        } else if (activeTab === 'ontology') {
             html = `
                <div class="grid md:grid-cols-2 gap-8 fade-in">
                    <div>
                        <h4 class="font-bold text-lg text-sky-800 mb-3">ê°œì²´ ìœ í˜• (ë…¸ë“œ)</h4>
                        <div class="space-y-2">
                            ${appData.ontology.nodes.map(n => `<div class="p-3 bg-stone-50 rounded-md"><p class="font-semibold text-stone-700">${n.name}</p><p class="text-sm text-stone-500">${n.desc}</p></div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg text-sky-800 mb-3">ê´€ê³„ ìœ í˜• (ì—£ì§€)</h4>
                        <div class="space-y-2">
                            ${appData.ontology.edges.map(e => `<div class="p-3 bg-stone-50 rounded-md"><p class="font-semibold text-stone-700">${e.name}</p><p class="text-sm text-stone-500">${e.desc}</p></div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        } else if (activeTab === 'ledger') {
            html = `
                <div class="fade-in">
                    <h4 class="font-bold text-lg text-sky-800 mb-4">ì£¼ìš” ê°œì²´ ë° ìì‚° ëŒ€ì¥</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-stone-500">
                            <thead class="text-xs text-stone-700 uppercase bg-stone-100">
                                <tr>
                                    <th scope="col" class="py-3 px-6">ëª…ì¹­</th>
                                    <th scope="col" class="py-3 px-6">ìœ í˜•</th>
                                    <th scope="col" class="py-3 px-6">ì£¼ìš” ì¼ì</th>
                                    <th scope="col" class="py-3 px-6">ì£¼ìš” ê¸ˆì „ ê°€ì¹˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${appData.ledger.map(item => `
                                    <tr class="bg-white border-b">
                                        <th scope="row" class="py-4 px-6 font-medium text-stone-900 whitespace-nowrap">${item.name}</th>
                                        <td class="py-4 px-6">${item.type}</td>
                                        <td class="py-4 px-6">${item.date}</td>
                                        <td class="py-4 px-6">${item.value}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        } else if (activeTab === 'chart') {
            html = `
                <div class="fade-in">
                    <h4 class="font-bold text-lg text-sky-800 mb-4">ë¶„ìŸë³„ ê´€ë ¨ ê¸ˆì „ ê°€ì¹˜ ë¹„êµ</h4>
                    <p class="text-sm text-stone-600 mb-4">ê° ë¶„ìŸê³¼ ì§ì ‘ì ìœ¼ë¡œ ì—°ê´€ëœ ì£¼ìš” ì±„ê¶Œ ë° ìì‚°ì˜ ê°€ì¹˜ë¥¼ ë¹„êµí•˜ì—¬ ì‚¬ê±´ì˜ ì¬ì‚°ì  ê·œëª¨ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    <div class="chart-container" style="position: relative; height:40vh; max-height:400px; width:100%; max-width:800px; margin:auto;">
                        <canvas id="disputes-chart"></canvas>
                    </div>
                </div>
            `;
        }
        phase1Content.innerHTML = html;

        if (activeTab === 'disputes') {
            renderDisputeDetails();
        } else if (activeTab === 'chart') {
            renderDisputesChart();
        }
    }
    
    function renderDisputesChart() {
        const chartCanvas = document.getElementById('disputes-chart');
        if (!chartCanvas) return;
        
        const chartData = {
            labels: [
                'ë¶„ìŸ 1: í•´ë“œë¦¼ ì±„ê¶Œ', 
                'ë¶„ìŸ 2: ì„±ìˆ˜ë™ ëŒ€ì—¬ê¸ˆ', 
                'ë¶„ìŸ 3: ì‹ ë¦¼ë™ ìƒê°€', 
                'ë¶„ìŸ 4: í‰íƒ ë¹Œë¼ ê³µì‚¬ëŒ€ê¸ˆ',
                'ë¶„ìŸ 5: í‘ì„ë™ ìƒê°€'
            ],
            datasets: [{
                label: 'ê¸ˆì•¡ (ì–µ ì›)',
                data: [2, 5, 2.4, 3, 10],
                backgroundColor: [
                    'rgba(56, 189, 248, 0.6)',
                    'rgba(251, 146, 60, 0.6)',
                    'rgba(234, 179, 8, 0.6)',
                    'rgba(16, 185, 129, 0.6)',
                    'rgba(139, 92, 246, 0.6)'
                ],
                borderColor: [
                    'rgb(56, 189, 248)',
                    'rgb(251, 146, 60)',
                    'rgb(234, 179, 8)',
                    'rgb(16, 185, 129)',
                    'rgb(139, 92, 246)'
                ],
                borderWidth: 1
            }]
        };

        new Chart(chartCanvas, {
            type: 'bar',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'ì£¼ìš” ë¶„ìŸ ê´€ë ¨ ê¸ˆì•¡' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    function renderDisputeDetails() {
        const detailsContainer = document.getElementById('dispute-details');
        const disputeData = appData.disputes[activeDispute];
        if (!detailsContainer || !disputeData) return;

        detailsContainer.innerHTML = `
            <div class="grid lg:grid-cols-2 gap-8">
                <div>
                    <h4 class="font-bold text-lg text-sky-800 mb-3">ì£¼ìš” ë²•ì  ìŸì </h4>
                    <ul class="space-y-2 list-disc list-inside text-stone-600 text-sm">
                        ${disputeData.issues.map(issue => `<li>${issue}</li>`).join('')}
                    </ul>
                    <h4 class="font-bold text-lg text-sky-800 mt-6 mb-3">ì§€ì‹ ê·¸ë˜í”„ ì‹œê°í™”</h4>
                    <p class="text-sm text-stone-600 mb-4">ì•„ë˜ ê·¸ë˜í”„ëŠ” í•´ë‹¹ ë¶„ìŸì˜ í•µì‹¬ ê°œì²´ì™€ ê´€ê³„ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œí˜„í•œ ê²ƒì…ë‹ˆë‹¤. ë…¸ë“œ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>
                <div class="card p-4">
                     <div id="kg-graph-container"></div>
                </div>
            </div>
        `;
        renderKgGraph(disputeData.nodes, disputeData.edges, 'kg-graph-container');
    }
    
    function renderKgGraph(nodes, edges, containerId, highlightedNodeId = null) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const nodeElements = {};

        nodes.forEach(node => {
            const nodeEl = document.createElement('div');
            nodeEl.id = `${containerId}-${node.id}`;
            nodeEl.className = 'kg-node';
            nodeEl.style.left = `${node.x}px`;
            nodeEl.style.top = `${node.y}px`;
            nodeEl.textContent = node.label;
            
            if(node.id === highlightedNodeId) {
                nodeEl.classList.add('highlight');
            }

            let bgColor = 'bg-stone-200';
            if (node.type === 'Person') bgColor = 'bg-blue-200';
            else if (node.type === 'Property') bgColor = 'bg-green-200';
            else if (node.type === 'Debt') bgColor = 'bg-red-200';
            else if (node.type === 'LegalEvent') bgColor = 'bg-yellow-200';
            else if (node.type === 'Rule') bgColor = 'bg-purple-200';
            nodeEl.classList.add(bgColor);

            nodeEl.addEventListener('mousemove', e => {
                tooltip.style.display = 'block';
                tooltip.style.left = `${e.pageX + 15}px`;
                tooltip.style.top = `${e.pageY + 15}px`;
                tooltip.textContent = node.details || node.label;
            });
            nodeEl.addEventListener('mouseout', () => {
                tooltip.style.display = 'none';
            });

            container.appendChild(nodeEl);
            nodeElements[node.id] = nodeEl;
        });

        edges.forEach(edge => {
            const fromNode = nodeElements[edge.from];
            const toNode = nodeElements[edge.to];
            if (!fromNode || !toNode) return;
            
            const fromRect = fromNode.getBoundingClientRect();
            const toRect = toNode.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();

            const fromX = fromNode.offsetLeft + fromNode.offsetWidth / 2;
            const fromY = fromNode.offsetTop + fromNode.offsetHeight / 2;
            const toX = toNode.offsetLeft + toNode.offsetWidth / 2;
            const toY = toNode.offsetTop + toNode.offsetHeight / 2;
            
            const angle = Math.atan2(toY - fromY, toX - fromX) * 180 / Math.PI;
            const length = Math.hypot(toX - fromX, toY - fromY);
            
            const edgeEl = document.createElement('div');
            edgeEl.className = 'kg-edge';
            edgeEl.style.left = `${fromX}px`;
            edgeEl.style.top = `${fromY}px`;
            edgeEl.style.width = `${length}px`;
            edgeEl.style.transform = `rotate(${angle}deg)`;
            container.appendChild(edgeEl);

            if (edge.label) {
                const labelEl = document.createElement('div');
                labelEl.className = 'kg-edge-label';
                labelEl.textContent = edge.label;
                const labelX = fromX + (toX - fromX) / 2;
                const labelY = fromY + (toY - fromY) / 2;
                labelEl.style.left = `${labelX - labelEl.offsetWidth / 2}px`;
                labelEl.style.top = `${labelY - labelEl.offsetHeight / 2}px`;
                container.appendChild(labelEl);
            }
        });
    }

    function renderRag() {
        const steps = [
            {
                title: '1. ì‚¬ìš©ì ì§ˆì˜',
                content: `<p class="font-mono p-4 bg-stone-100 rounded-md">"ê°•ìš©ì›ì€ ì„±ìˆ˜ë™ ëŒ€ì§€ì™€ ê´€ë ¨í•˜ì—¬ ìì‹ ì´ ê°€ì§€ëŠ” ëª¨ë“  ê¶Œë¦¬ë¥¼ ì‹¤í˜„í•˜ê¸° ìœ„í•œ ì†Œì˜ ì œê¸°ë¥¼ í¬ë§í•œë‹¤."</p>`
            },
            {
                title: '2. ì§€ì‹ ê·¸ë˜í”„ ê²€ìƒ‰ (êµ¬ì¡°ì  + ì˜ë¯¸ë¡ ì )',
                content: `<p class="mb-2 text-sm text-stone-600">ì§ˆì˜ë¥¼ ë¶„ì„í•˜ì—¬ ì§€ì‹ ê·¸ë˜í”„ì—ì„œ ê´€ë ¨ í•˜ìœ„ ê·¸ë˜í”„ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ì‚¬ì‹¤ê´€ê³„ì™€ ì ìš© ë²•ë¦¬ê°€ ëª¨ë‘ í¬í•¨ë©ë‹ˆë‹¤.</p><div id="rag-graph-container" class="card p-2 h-[400px] overflow-hidden"><div id="rag-kg-graph"></div></div>`
            },
            {
                title: '3. ì»¨í…ìŠ¤íŠ¸ ì¦ê°• ë° ì—„ê²©í•œ í”„ë¡¬í”„íŠ¸',
                content: `
                    <p class="mb-2 text-sm text-stone-600">ê²€ìƒ‰ëœ ì •ë³´ë¥¼ LLMì—ê²Œ 'ì»¨í…ìŠ¤íŠ¸'ë¡œ ì œê³µí•˜ê³ , ì œê³µëœ ì •ë³´ë§Œì„ ì‚¬ìš©í•˜ë„ë¡ ì—„ê²©íˆ ì§€ì‹œí•©ë‹ˆë‹¤.</p>
                    <div class="font-mono text-xs p-4 bg-stone-800 text-stone-200 rounded-md">
                        <p><span class="text-purple-400">### ì§€ì‹œì‚¬í•­ ###</span><br>ë‹¹ì‹ ì€ ë²•ë¥  ë¶„ì„ ì¢…í•©ê¸°ì…ë‹ˆë‹¤. ì•„ë˜ 'ì»¨í…ìŠ¤íŠ¸' ì •ë³´ë§Œì„ ì‚¬ìš©í•˜ì—¬... ëª¨ë“  ì§„ìˆ ì— ì¶œì²˜ë¥¼ ëª…ì‹œí•˜ì‹œì˜¤.<br><br><span class="text-purple-400">### ì»¨í…ìŠ¤íŠ¸ ###</span><br><span class="text-green-400">{ "node_id": "e1", "type": "PaymentMade", ... }</span><br><span class="text-green-400">{ "node_id": "r1", "type": "LegalRule", "citation": "ë¯¼ë²• ì œ477ì¡°", ... }</span><br>...<br><br><span class="text-purple-400">### ì‚¬ìš©ì ì§ˆì˜ ###</span><br>"...ê°•ìš©ì›ì´ ì œê¸°í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ë²•ì  ì²­êµ¬ë¥¼ ì„¤ëª…í•˜ì‹œì˜¤."</p>
                    </div>
                `
            },
            {
                title: '4. ê·¼ê±° ê¸°ë°˜ ë‹µë³€ ìƒì„±',
                content: `<p class="mb-2 text-sm text-stone-600">LLMì€ ì œê³µëœ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…í•©í•˜ì—¬, ëª¨ë“  ì£¼ì¥ì˜ ê·¼ê±°ê°€ ëª…ì‹œëœ(<span class="rag-ref cursor-pointer" data-node="p3">p3</span>) ì„¤ëª…ê°€ëŠ¥í•œ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤. ì•„ë˜ ë‹µë³€ì˜ ì¶œì²˜ íƒœê·¸ë¥¼ í´ë¦­í•˜ë©´ ê·¸ë˜í”„ì˜ í•´ë‹¹ ë…¸ë“œê°€ ê°•ì¡° í‘œì‹œë©ë‹ˆë‹¤.</p><div id="rag-analysis-output">${appData.rag.analysis}</div>`
            }
        ];
        
        let html = `
            <div class="flex items-center justify-between mb-6">
                 <button id="rag-prev" class="px-4 py-2 bg-stone-200 hover:bg-stone-300 text-stone-700 rounded-md transition disabled:opacity-50" ${ragStep === 0 ? 'disabled' : ''}>ì´ì „</button>
                 <h3 class="text-xl font-bold text-center text-sky-800">${steps[ragStep].title}</h3>
                 <button id="rag-next" class="px-4 py-2 bg-sky-700 hover:bg-sky-800 text-white rounded-md transition disabled:opacity-50" ${ragStep === steps.length - 1 ? 'disabled' : ''}>ë‹¤ìŒ</button>
            </div>
            <div id="rag-step-content" class="fade-in min-h-[420px]">
                ${steps[ragStep].content}
            </div>
        `;
        ragContainer.innerHTML = html;

        if(ragStep === 1) {
            renderKgGraph(appData.rag.subgraph.nodes, [], 'rag-kg-graph');
        }
        if(ragStep === 3) {
            const outputContainer = document.getElementById('rag-analysis-output');
            const graphContainer = document.createElement('div');
            graphContainer.id = "rag-kg-graph-final";
            graphContainer.className = "card p-2 h-[250px] mb-4 overflow-hidden";
            outputContainer.prepend(graphContainer);
            renderKgGraph(appData.rag.subgraph.nodes, [], 'rag-kg-graph-final');
        }
    }

    phase1Content.addEventListener('click', e => {
        const card = e.target.closest('.dispute-card');
        if (card) {
            activeDispute = card.dataset.dispute;
            document.querySelectorAll('.dispute-card').forEach(c => c.classList.remove('ring-2', 'ring-sky-600'));
            card.classList.add('ring-2', 'ring-sky-600');
            renderDisputeDetails();
        }
    });

    phase1Tabs.addEventListener('click', e => {
        if (e.target.matches('.tab-button')) {
            activeTab = e.target.dataset.tab;
            renderPhase1();
        }
    });
    
    document.getElementById('nav-phase1').addEventListener('click', () => {
        document.getElementById('phase1').scrollIntoView({behavior:'smooth'});
    });
    document.getElementById('nav-phase2').addEventListener('click', () => {
        document.getElementById('phase2').scrollIntoView({behavior:'smooth'});
    });

    ragContainer.addEventListener('click', e => {
        if (e.target.id === 'rag-next' && ragStep < 3) {
            ragStep++;
            renderRag();
        } else if (e.target.id === 'rag-prev' && ragStep > 0) {
            ragStep--;
            renderRag();
        } else if (e.target.matches('.rag-ref')) {
            const nodeId = e.target.dataset.node;
            renderKgGraph(appData.rag.subgraph.nodes, [], 'rag-kg-graph-final', nodeId);
        }
    });

    renderPhase1();
    renderRag();
});
</script>
</body>
</html>
